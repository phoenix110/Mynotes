## Dockerfile是一个镜像的表示，可以通过Dockerfile来描述构建镜像的步骤，并自动构建一个容器。
## 所有的 Dockerfile 命令格式都是:
```
INSTRUCTION arguments 虽然指令忽略大小写，但是建议使用大写。
FROM 命令(FROM 或 FROM :这个设置基本的镜像，为后续的命令使用，所以应该作为Dockerfile的第一条指令。)
比如: FROM centos:v1 如果没有指定 tag ，则默认tag是latest，如果都没有则会报错。
RUN 命令(RUN命令会在上面FROM指定的镜像里执行任何命令，然后提交(commit)结果，提交的镜像会在后面继续用到。)
两种格式:
RUN  (the command is run in a shell - `/bin/sh -c`)
或:
RUN ["executable", "param1", "param2" ... ]  (exec form)
RUN命令等价于:
docker run image command
docker commit container_id
```
## 编写Dockerfile,根据上面的操作步骤，在docker服务器端创建Dockerfile文件，内容如下：
```
# 设置基本的镜像，后续命令都以这个镜像为基础
FROM centos:v1
# 作者信息
AINTAINER  JFEDU.NET
# RUN命令会在上面指定的镜像里执行任何命令
RUN yum install passwd openssl openssh-server -y
RUN echo '123456' | passwd --stdin root
RUN ssh-keygen -q -t rsa -b 2048 -f /etc/ssh/ssh_host_rsa_key -N ''
RUN ssh-keygen -q -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -N ''
RUN sed -i '/^session\s\+required\s\+pam_loginuid.so/s/^/#/' /etc/pam.d/sshd
RUN mkdir -p /root/.ssh && chown root.root /root && chmod 700 /root/.ssh
```
# 根据Dockerfile来创建镜像
```
sudo docker build . -t docker-public.lwork.com:5000/${ARTIFACT}:v${releaseNum}
```
Dockerfile示例
```
FROM docker-public.lwork.com:5000/base-jdk:v1.2
ENV artifact bw-copy-trade
ENV cfile app.toml                                                                                   
ENV workingDir /home/brokerwork
ENV user brokerwork

RUN useradd $user -m -d $workingDir && \
    mkdir $workingDir/log && \
        ln -s /dev/stdout $workingDir/log/process.log && \
    ln -s /dev/stdout $workingDir/log/access.log && \
    chown $user:$user $workingDir/log && \
    chmod 755 $workingDir
ADD $artifact /home/$user/$artifact
ADD start-s.sh /home/$user/start.sh
COPY $cfile /home/$user/
WORKDIR $workingDir
RUN chmod +x $artifact start.sh
USER $user
CMD ["sh", "-c", "./start.sh ${artifact}"]
```
```
if [ ${UPLOAD_NO_MASTER} = true  ]; then
    releaseNum=$(mvn info |grep "Building $ARTIFACT"|awk '{print $4}')
    echo '------------'
    echo $releaseNum
    echo '------------'
    sudo docker login docker-public.lwork.com:5000 -u admin -p leanwork2018
    sudo docker build . -t docker-public.lwork.com:5000/${ARTIFACT}:v${releaseNum}
    sudo docker push docker-public.lwork.com:5000/${ARTIFACT}:v${releaseNum}
    sudo docker rmi docker-public.lwork.com:5000/${ARTIFACT}:v${releaseNum}
    sudo docker logout docker-public.lwork.com:5000
else
    echo "{'name': '$ARTIFACT', 'version': '$VERSION', 'time': '$TIME'}" > ${RELEASE_INFO}
    mvn clean install ||PEXIT "error"
fi
```